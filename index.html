<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- iOS ve PWA Ayarlarƒ± -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fdfbf7">
    <title>Writing Tool</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiV3JpdGluZyBUb29sIiwiXHNob3J0X25hbWUiOiJXcml0aW5nVG9vbCIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmRmYmY3IiwidGhlbWVfY29sb3IiOiIjM2E2ZWE1IiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vdmlhLnBsYWNlaG9sZGVyLmNvbS8xOTIiLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn1dfQ==">

    <!-- 
        =============================================
        GOOGLE ADSENSE
        =============================================
    -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4105263661615439" crossorigin="anonymous"></script>

    <!-- K√ºt√ºphaneler -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* G√ºnd√ºz Modu (Varsayƒ±lan) */
            --bg-color: #fdfbf7;      
            --text-color: #1e293b;
            --text-muted: #64748b;    
            --primary-blue: #3a6ea5;  
            --primary-gold: #cfa15c;  
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --input-bg: #fcfcfc;
            --danger: #ef4444;
            --success: #10b981;
            --modal-overlay: rgba(0,0,0,0.6);
            --scale-factor: 1; 
        }

        /* Gece Modu (Dark Mode) */
        body.dark-mode {
            --bg-color: #121212;
            --text-color: #e2e2e2;
            --text-muted: #a0a0a0;
            --primary-blue: #64b5f6;
            --primary-gold: #ffd54f;
            --card-bg: #1e1e1e;
            --border-color: #333333;
            --input-bg: #2c2c2c;
            --modal-overlay: rgba(0,0,0,0.8);
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            height: 100dvh; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            touch-action: manipulation;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- √úST KONTROLLER (Anasayfa Simetrik) --- */
        .top-controls-right {
            position: absolute; top: 20px; right: 20px; z-index: 1000; display: flex; gap: 10px;
        }
        .top-controls-left {
            position: absolute; top: 20px; left: 20px; z-index: 1000; display: flex; gap: 10px;
        }

        /* Hap ≈ûekilli Kontrol Kutusu (Ortak Stil) */
        .control-pill {
            background: var(--card-bg);
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer; /* Tƒ±klanabilir yap */
        }

        .icon-btn-text {
            background: none; border: none; cursor: pointer; font-size: 16px; padding: 2px;
            transition: transform 0.2s; color: var(--text-color);
        }
        .icon-btn-text:hover { transform: scale(1.1); }
        .icon-btn-text.active { color: var(--primary-blue); font-weight: bold; border-bottom: 2px solid var(--primary-blue); }

        /* --- ORTAK BUTONLAR --- */
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: var(--text-color);
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            -webkit-tap-highlight-color: transparent;
        }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 6px rgba(0,0,0,0.05); filter: brightness(0.95); }
        .btn-primary { background: var(--primary-blue); color: white; border: none; }
        .btn-gold { background: var(--primary-gold); color: white; border: none; }
        .btn-danger { background: var(--danger); color: white; border: none; }
        .btn-success { background: var(--success); color: white; border: none; }

        /* --- SAYFALAR --- */
        .view-section { display: none; height: 100%; width: 100%; position: relative; }
        .view-section.active { display: flex; flex-direction: column; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ANASAYFA */
        #view-home { align-items: center; justify-content: center; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }
        .home-container { width: 100%; max-width: 800px; text-align: center; padding: 40px 20px; }
        .logo-area svg { width: 140px; height: 140px; margin-bottom: 25px; filter: drop-shadow(0 8px 16px rgba(58, 110, 165, 0.15)); }
        
        /* Anasayfa Ba≈ülƒ±k (B√ºy√ºt√ºld√º) */
        .home-title { font-size: 42px; font-weight: 900; letter-spacing: -1px; margin: 0 0 30px 0; color: var(--text-color); }

        /* Anasayfa Butonlar (Yukarƒ± Ta≈üƒ±ndƒ±) */
        .home-buttons { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-bottom: 50px; }
        .big-btn { width: 200px; height: 100px; border-radius: 16px; border: none; cursor: pointer; color: white; font-weight: 700; font-size: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; transition: transform 0.2s; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .big-btn:hover { transform: translateY(-5px); }
        .btn-projects { background: linear-gradient(135deg, #3a6ea5 0%, #2c5282 100%); }
        .btn-new { background: linear-gradient(135deg, #cfa15c 0%, #b08d55 100%); }
        
        /* Alt Ba≈ülƒ±k ve A√ßƒ±klama (A≈üaƒüƒ± Ta≈üƒ±ndƒ± ve K√º√ß√ºlt√ºld√º) */
        .home-subtitle { font-size: 14px; font-weight: 700; color: var(--primary-gold); letter-spacing: 1px; margin-bottom: 20px; border-bottom: 3px solid var(--primary-gold); display: inline-block; padding-bottom: 5px;}
        .home-description { 
            font-family: 'Merriweather', serif; 
            font-size: 14px; /* K√º√ß√ºlt√ºld√º */
            line-height: 1.6; 
            color: var(--text-muted); 
            margin-bottom: 40px; 
            text-align: left; 
            max-width: 700px; 
            margin-left: auto; margin-right: auto; 
        }
        .home-description p { margin-bottom: 10px; }

        /* √áALI≈ûMA MASASI */
        .workspace-header { background: var(--card-bg); padding: 0 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; height: 64px; flex-shrink: 0; z-index: 10; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02); }
        .header-left, .header-center, .header-right { display: flex; align-items: center; gap: 10px; }
        
        /* Proje ƒ∞√ßi Mod Butonu (Hap ≈ûeklinde, Header Altƒ±nda) */
        .workspace-mode-pill {
            position: absolute; 
            left: 20px; 
            top: 80px; /* Header'ƒ±n (64px) ve biraz bo≈üluƒüun altƒ±nda */
            z-index: 90;
        }

        /* Zoom Kontrolleri (Sol Orta - K√º√ß√ºk ve ≈ûeffaf) */
        .zoom-controls-left {
            position: fixed; left: 10px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 5px;
            background: var(--card-bg); border: 1px solid var(--border-color);
            padding: 8px 4px; border-radius: 20px;
            z-index: 90; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            opacity: 0.3; transition: opacity 0.3s;
        }
        .zoom-controls-left:hover { opacity: 1; }
        
        .zoom-slider-v {
            writing-mode: bt-lr; /* IE */
            -webkit-appearance: slider-vertical; /* Webkit */
            width: 8px; height: 80px;
            cursor: pointer;
        }

        .workspace-body { flex-grow: 1; display: flex; overflow: hidden; position: relative; background-image: radial-gradient(var(--border-color) 1px, transparent 1px); background-size: 20px 20px; }
        .list-container { flex-grow: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; align-items: center; -webkit-overflow-scrolling: touch; padding-bottom: 100px; }
        .list-wrapper { width: 100%; max-width: 800px; transform-origin: top center; transform: scale(var(--scale-factor)); margin: 0 auto; }

        /* Proje Ba≈ülƒ±ƒüƒ± (Liste √úst√º - B√ºy√ºk) */
        .workspace-project-title {
            font-size: 32px; font-weight: 800; color: var(--text-color);
            margin-bottom: 30px; text-align: center; width: 100%; max-width: 800px;
            border: none; background: transparent; outline: none;
            font-family: 'Inter', sans-serif; padding: 10px;
            border-bottom: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .workspace-project-title:focus { border-bottom: 2px solid var(--primary-blue); }
        .workspace-project-title::placeholder { color: var(--border-color); }

        /* KARTLAR */
        .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: box-shadow 0.2s; }
        .card-header { display: flex; align-items: center; padding: 12px 15px; gap: 12px; }
        .drag-handle { color: #cbd5e1; cursor: grab; font-size: 20px; padding: 5px; touch-action: none; }
        .item-number-input { width: 32px; height: 32px; text-align: center; border: 1px solid var(--border-color); background: var(--input-bg); border-radius: 8px; font-weight: bold; color: var(--primary-blue); outline: none; }
        .item-title-input { flex-grow: 1; border: none; background: transparent; font-size: 16px; font-weight: 600; color: var(--text-color); resize: none; font-family: 'Inter', sans-serif; outline: none; }
        
        .content-area { display: none; padding: 15px; border-top: 1px dashed var(--border-color); position: relative; }
        .content-area.show { display: block; }
        
        textarea.smart-input { width: 100%; border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; font-family: 'Merriweather', serif; line-height: 1.6; resize: vertical; background: var(--input-bg); color: var(--text-color); box-sizing: border-box; outline: none; }
        textarea.smart-input:focus { border-color: var(--primary-blue); box-shadow: 0 0 0 2px rgba(58, 110, 165, 0.1); }
        
        .word-count-badge { position: absolute; bottom: 8px; right: 25px; font-size: 11px; color: var(--text-muted); opacity: 0.8; pointer-events: none; background: var(--card-bg); padding: 2px 5px; border-radius: 4px; border: 1px solid var(--border-color); }

        /* Toplam Kelime Sayacƒ± (K√º√ß√ºlt√ºld√º) */
        .total-word-count {
            position: fixed; bottom: 20px; right: 20px;
            background: var(--primary-blue); color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 90; pointer-events: none;
            transition: opacity 0.3s;
            display: flex; align-items: center; gap: 5px;
        }

        /* MODALLAR */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--modal-overlay); backdrop-filter: blur(2px); z-index: 100; justify-content: center; align-items: center; animation: fadeIn 0.2s; }
        .modal-content { background: var(--card-bg); width: 90%; max-width: 500px; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); display: flex; flex-direction: column; max-height: 85vh; border: 1px solid var(--border-color); }
        .modal-content.large { max-width: 800px; height: 90vh; background: transparent; border: none; box-shadow: none; }
        .modal-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: var(--bg-color); border-radius: 16px 16px 0 0; }
        .modal-header h3 { margin: 0; color: var(--text-color); }
        .modal-body { padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        
        .proj-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid var(--border-color); border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; background: var(--input-bg); }
        .proj-item:hover { border-color: var(--primary-blue); transform: translateX(5px); }

        .preview-paper {
            background: white; color: black;
            width: 21cm; min-height: 29.7cm; padding: 2.54cm; margin: 0 auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.5); overflow-y: visible;
            font-family: 'Times New Roman', Times, serif; line-height: 1.6; font-size: 12pt;
            outline: none; cursor: text;
        }
        
        /* Sadece Metin Modu ƒ∞√ßin CSS */
        .preview-paper.clean-view h3 { display: none; }
        .preview-paper.clean-view h1 { display: none; } /* Proje ba≈ülƒ±ƒüƒ±nƒ± da gizlemek isterseniz */

        .preview-body { padding: 20px; flex-grow: 1; overflow-y: auto; display: flex; justify-content: center; }

        .ad-banner { width: 100%; text-align: center; background: transparent; min-height: 0; overflow: hidden; flex-shrink: 0; padding: 10px 0; }
        .bulk-area { display: none; width: 100%; max-width: 800px; margin-bottom: 20px; background: var(--card-bg); padding: 20px; border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 10px 15px rgba(0,0,0,0.1); }

        /* Responsive */
        @media (max-width: 600px) {
            .top-controls-left, .top-controls-right { top: 10px; }
            .home-container { padding: 30px 20px; }
            .home-title { font-size: 32px; }
            .preview-paper { width: 95%; padding: 20px; }
            .workspace-header { padding: 0 10px; height: auto; flex-wrap: wrap; justify-content: center; gap: 5px; padding-bottom: 10px; }
            .header-center { order: 3; width: 100%; justify-content: center; border-top: 1px solid var(--border-color); padding-top: 5px; }
            .workspace-project-title { font-size: 24px; margin-bottom: 20px; }
            .workspace-mode-pill { top: 90px; } /* Mobilde header uzadƒ±ƒüƒ± i√ßin */
        }
    </style>
</head>
<body>

    <!-- ANASAYFA SOL √úST KONTROL (MOD) -->
    <div class="top-controls-left" id="homeModeControl">
        <div class="control-pill" onclick="toggleDarkMode()">
            <span data-key="mode_label">Mode:</span> üåô / ‚òÄÔ∏è
        </div>
    </div>

    <!-- ANASAYFA SAƒû √úST KONTROL (Dƒ∞L) -->
    <div class="top-controls-right" id="langControl">
        <div class="control-pill">
            <span data-key="language_label">Lang:</span>
            <button class="icon-btn-text" onclick="setLanguage('en')" id="btn-en">üá¨üáß</button>
            <div style="width:1px; height:15px; background:var(--border-color);"></div>
            <button class="icon-btn-text" onclick="setLanguage('tr')" id="btn-tr">üáπüá∑</button>
        </div>
    </div>

    <!-- ANASAYFA -->
    <div id="view-home" class="view-section active">
        <div class="home-container">
            <div class="logo-area">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 80 L30 80 L35 75" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round"/>
                    <path d="M80 80 L70 80 L65 75" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round"/>
                    <rect x="35" y="65" width="30" height="25" rx="4" stroke="#cfa15c" stroke-width="2" fill="white"/>
                    <circle cx="42" cy="72" r="2" fill="#cfa15c"/>
                    <circle cx="58" cy="72" r="2" fill="#cfa15c"/>
                    <path d="M70 20 C70 20 50 25 40 45 C35 55 35 65 48 65 C60 65 75 50 80 30 C82 20 70 20 70 20 Z" fill="#3a6ea5" stroke="#2c5282" stroke-width="2"/>
                    <path d="M48 65 L35 85" stroke="#2c5282" stroke-width="3" stroke-linecap="round"/>
                    <path d="M35 85 L32 92 L38 92 Z" fill="#2c5282"/>
                    <path d="M40 45 C45 45 65 30 70 20" stroke="white" stroke-width="1.5" stroke-opacity="0.5"/>
                </svg>
            </div>

            <!-- Ana Ba≈ülƒ±k (B√ºy√ºt√ºld√º) -->
            <div class="home-title" data-key="app_title">WRITING TOOL</div>

            <!-- Butonlar (Yukarƒ± Ta≈üƒ±ndƒ±) -->
            <div class="home-buttons">
                <button class="big-btn btn-projects" onclick="openProjectsModal()">
                    <span style="font-size:24px">üìÇ</span> <span data-key="btn_my_projects">MY PROJECTS</span>
                </button>
                <button class="big-btn btn-new" onclick="openNewProjectModal()">
                    <span style="font-size:24px">‚ûï</span> <span data-key="btn_new_project">NEW PROJECT</span>
                </button>
            </div>

            <!-- Alt Ba≈ülƒ±k ve A√ßƒ±klama (A≈üaƒüƒ± Ta≈üƒ±ndƒ± ve K√º√ß√ºlt√ºld√º) -->
            <div class="home-subtitle" data-key="app_subtitle">WHAT IS THE WRITING TOOL?</div>
            <div class="home-description" data-key="app_description"></div>

            <div class="ad-banner">
                <!-- AdSense Home -->
            </div>
        </div>
    </div>

    <!-- √áALI≈ûMA MASASI -->
    <div id="view-workspace" class="view-section">
        <div class="workspace-header">
            <div class="header-left">
                <button class="btn" onclick="goHome()">üè† <span data-key="nav_home">Home</span></button>
                <button class="btn" onclick="saveData(true)">üíæ <span data-key="nav_save">Save</span></button>
                <button class="btn" onclick="exportProject()">üì§ <span data-key="nav_export">Export</span></button>
            </div>
            
            <div class="header-right">
                <button class="btn" onclick="toggleAll('desc')">üìù <span data-key="nav_notes">Notes</span></button>
                <button class="btn" onclick="toggleAll('content')">‚úç <span data-key="nav_drafts">Drafts</span></button>
                <button class="btn btn-primary" onclick="toggleBulk()">+ <span data-key="nav_bulk">Bulk</span></button>
                <button class="btn btn-gold" onclick="addItem()">+ <span data-key="nav_single">Add</span></button>
                <button class="btn btn-success" onclick="openPreview()">üëÅ <span data-key="nav_preview">Preview</span></button>
            </div>
        </div>

        <div class="workspace-body">
            <!-- Proje ƒ∞√ßi Mod Butonu (Hap ≈ûeklinde, Solda Home Altƒ±nda) -->
            <div class="workspace-mode-pill control-pill" onclick="toggleDarkMode()">
                <span data-key="mode_label">Mode:</span> üåô / ‚òÄÔ∏è
            </div>

            <!-- Sol Orta Zoom Kontrol -->
            <div class="zoom-controls-left">
                <div style="font-size:10px; text-align:center;">+</div>
                <input type="range" min="0.5" max="1.1" step="0.05" value="1" class="zoom-slider-v" oninput="changeZoom(this.value)">
                <div style="font-size:10px; text-align:center;">-</div>
            </div>

            <div class="list-container">
                <!-- Proje Ba≈ülƒ±ƒüƒ± (Maddelerin √úst√ºnde) -->
                <input type="text" class="workspace-project-title" id="wsProjTitleInput" placeholder="Project Title" oninput="updateProjectTitle(this.value)">

                <div class="bulk-area" id="bulkArea">
                    <h4 style="margin-top:0;" data-key="bulk_title">Bulk Add Items</h4>
                    <div style="font-size:12px; color:var(--text-muted); margin-bottom:10px;" data-key="bulk_desc">Paste items...</div>
                    <textarea id="bulkTextInput"></textarea>
                    <div style="text-align:right; margin-top:10px;">
                        <button class="btn" onclick="toggleBulk()" data-key="btn_cancel">Cancel</button>
                        <button class="btn btn-primary" onclick="processBulk()" data-key="btn_add">Add</button>
                    </div>
                </div>

                <div class="list-wrapper" id="listWrapper"></div>
            </div>
        </div>

        <!-- Toplam Kelime Sayacƒ± (K√º√ß√ºlt√ºld√º) -->
        <div class="total-word-count" id="totalWordCount">
            <span>üìù</span> 0 Words
        </div>

        <div class="ad-banner">
            <!-- AdSense Workspace Bottom -->
        </div>
    </div>

    <!-- PROJELER MODALI -->
    <div class="modal-overlay" id="projectsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-key="modal_saved_projects">Saved Projects</h3>
                <button class="btn" onclick="closeModal('projectsModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <ul class="proj-list" id="projectsListEl"></ul>
                <div id="noProjectsMsg" style="text-align:center; padding:20px; color:var(--text-muted);" data-key="msg_no_projects">...</div>
            </div>
            <div style="padding:15px; text-align:right;">
                <button class="btn btn-gold" onclick="closeModal('projectsModal'); openNewProjectModal()">+ <span data-key="btn_create_new">New</span></button>
            </div>
        </div>
    </div>

    <!-- YENƒ∞ PROJE / Y√úKLEME MODALI -->
    <div class="modal-overlay" id="newProjectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-key="modal_new_project">New Project</h3>
                <button class="btn" onclick="closeModal('newProjectModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p style="font-size:14px; color:var(--text-muted); margin-bottom:5px;">Create a blank project:</p>
                <input type="text" id="newProjNameInput" style="width:100%; padding:12px; border:1px solid var(--border-color); border-radius:8px; background:var(--input-bg); color:var(--text-color); box-sizing:border-box;" placeholder="Name..." onkeypress="handleEnterProject(event)">
                <div style="text-align:right; margin-top:10px;">
                     <button class="btn btn-primary" onclick="createProjectAction()" data-key="btn_create_start">Create</button>
                </div>

                <div style="margin-top:30px; border-top:1px solid var(--border-color); padding-top:20px; text-align:center;">
                    <div style="font-size:14px; color:var(--text-muted); margin-bottom:15px;" data-key="lbl_or_import">Or restore a project from backup:</div>
                    <button class="btn btn-gold" onclick="document.getElementById('importProjFile').click()">üìÇ <span data-key="btn_import_proj">Load Backup (.json)</span></button>
                    <!-- YENƒ∞: JSON Dosyalarƒ± i√ßin 'accept' eklendi -->
                    <input type="file" id="importProjFile" style="display:none" accept=".json" onchange="importProject(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- √ñNƒ∞ZLEME MODALI -->
    <div class="modal-overlay" id="previewModal">
        <div class="modal-content large">
            <div class="modal-header" style="background:white; border-bottom:1px solid #eee;">
                <h3 data-key="preview_title" style="color:#333;">Preview</h3>
                <div style="display:flex; gap:10px;">
                    <!-- SADECE METƒ∞N G√ñR√úNT√úLEME BUTONU -->
                    <button class="btn" onclick="toggleCleanView()" id="btnCleanView">üìú <span data-key="btn_text_only">Text Only</span></button>
                    <button class="btn" onclick="exportWord()">üìÑ <span data-key="btn_word">Word</span></button>
                    <button class="btn btn-primary" onclick="closeModal('previewModal')">‚úï</button>
                </div>
            </div>
            <div class="preview-body" style="background:rgba(0,0,0,0.5);">
                <div id="previewPaper" class="preview-paper" contenteditable="true"></div>
            </div>
        </div>
    </div>

<script>
    const translations = {
        en: {
            language_label: "Lang:", mode_label: "Mode:",
            app_title: "WRITING TOOL", app_subtitle: "WHAT IS THE WRITING TOOL?",
            app_description: `
                <p>The Writing Tool is a simple instrument for creating outlines for your complex texts and easily organizing this flow. For those who wish, it is also possible to write the entire text within the "Writing Tool"!</p>
                <p>When you enter your text flow into the system in bulk or step by step, all items of the flow will be numbered by the system. At this point, you can enter descriptions for the items and change their places as you wish to finalize the fiction of the text.</p>
                <p>To write the text from within the "Writing Tool", you can add text specific to the item, view your text from the "Preview" section when the entire flow is completed, and get a printout.</p>
                <p>To continue your work on another device, you can use the export feature within your project, and restore it on the new device.</p>
                <p>We wish you success in your studies.</p>
            `,
            btn_my_projects: "MY PROJECTS", btn_new_project: "NEW PROJECT",
            nav_home: "Home", nav_save: "Save", nav_export: "Export", nav_notes: "Notes", nav_drafts: "Drafts", nav_bulk: "Bulk", nav_single: "Add", nav_preview: "Preview",
            bulk_title: "Bulk Add Items", bulk_desc: "Paste your items line by line.", btn_add: "Add Items", btn_cancel: "Cancel",
            modal_saved_projects: "Saved Projects", msg_no_projects: "You don't have any projects yet.", btn_create_new: "New Project",
            modal_new_project: "Create New Project", btn_create_start: "Create & Start",
            lbl_or_import: "Or restore a project from backup:", btn_import_proj: "Load Backup (.json)",
            preview_title: "Free Edit & Preview", btn_word: "Download Word", btn_text_only: "Text Only",
            ph_item_title: "Item Title...", ph_desc: "Section notes...", ph_text: "Write your text here...",
            alert_save: "Project saved successfully!", alert_import: "Project restored successfully!", word_label: "Words"
        },
        tr: {
            language_label: "Dil:", mode_label: "Mod:",
            app_title: "YAZARLIK APARATI", app_subtitle: "YAZARLIK APARATI NEDƒ∞R?",
            app_description: `
                <p>Yazarlƒ±k Aparatƒ±, karma≈üƒ±k metinleriniz i√ßin akƒ±≈ü (outline) √ßƒ±karmaya ve bu akƒ±≈üƒ± kolayca d√ºzenlemenize yarayan basit bir ara√ßtƒ±r. Arzu edenler i√ßin metnin tamamƒ±nƒ± ‚ÄúYazarlƒ±k Aparatƒ±" i√ßinde yazmak da m√ºmk√ºn!</p>
                <p>Metninizin akƒ±≈üƒ±nƒ± sisteme toplu olarak ya da adƒ±m adƒ±m girdiƒüinizde akƒ±≈üƒ±n t√ºm maddeleri sistem tarafƒ±ndan numaralandƒ±rƒ±lacaktƒ±r. Bu noktada maddelere a√ßƒ±klamalar girebilir ve onlarƒ±n yerlerini istediƒüiniz gibi deƒüi≈ütirerek metnin kurgusuna son halini verebilirsiniz.</p>
                <p>Metni ‚ÄúYazarlƒ±k Aparatƒ±‚Äù i√ßinden yazmak i√ßin ise madde √∂zelinde metin ekleyebilir, t√ºm akƒ±≈ü tamamladƒ±ƒüƒ±nda ‚Äú√ñnizle" kƒ±smƒ±ndan metninizi g√∂r√ºnt√ºleyebilir ve √ßƒ±ktƒ± alabilirsiniz.</p>
                <p>√áalƒ±≈ümanƒ±za bir ba≈üka cihazda devam etmek i√ßin projenizin i√ßinden dƒ±≈üa aktarƒ±m (export) yapabilir, yeni cihazda bu dosyayƒ± y√ºkleyerek √ßalƒ±≈ümanƒ±za devam edebilirsiniz.</p>
                <p>√áalƒ±≈ümalarƒ±nƒ±zda ba≈üarƒ±lar dileriz.</p>
            `,
            btn_my_projects: "PROJELERƒ∞M", btn_new_project: "YENƒ∞ PROJE",
            nav_home: "Anasayfa", nav_save: "Kaydet", nav_export: "Dƒ±≈üa Aktar", nav_notes: "Notlar", nav_drafts: "Metin", nav_bulk: "Toplu", nav_single: "Ekle", nav_preview: "√ñnizle",
            bulk_title: "Toplu Madde Ekle", bulk_desc: "Maddelerinizi alt alta yapƒ±≈ütƒ±rƒ±n.", btn_add: "Ekle", btn_cancel: "ƒ∞ptal",
            modal_saved_projects: "Kayƒ±tlƒ± Projelerim", msg_no_projects: "Hen√ºz hi√ß projen yok.", btn_create_new: "Yeni Proje",
            modal_new_project: "Yeni Proje Olu≈ütur", btn_create_start: "Olu≈ütur ve Ba≈üla",
            lbl_or_import: "Veya yedekten proje y√ºkle:", btn_import_proj: "Yedek Y√ºkle (.json)",
            preview_title: "Serbest D√ºzenleme & √ñnizleme", btn_word: "Word ƒ∞ndir", btn_text_only: "Sadece Metin",
            ph_item_title: "Madde Ba≈ülƒ±ƒüƒ±...", ph_desc: "B√∂l√ºm notlarƒ±...", ph_text: "Metninizi buraya yazƒ±n...",
            alert_save: "Proje ba≈üarƒ±yla kaydedildi!", alert_import: "Proje ba≈üarƒ±yla y√ºklendi!", word_label: "Kelime"
        }
    };

    let appData = { projects: [] };
    let activeProjectId = null;
    let currentLang = localStorage.getItem('yazarAparatLang') || 'en';
    let isDarkMode = localStorage.getItem('yazarAparatDark') === 'true';

    document.addEventListener('DOMContentLoaded', () => {
        try {
            loadData();
            setLanguage(currentLang);
            applyDarkMode();
            
            const listWrapper = document.getElementById('listWrapper');
            if(listWrapper) {
                new Sortable(listWrapper, {
                    handle: '.drag-handle', animation: 150, onEnd: (evt) => {
                        const project = getActiveProject();
                        if(project) {
                            const item = project.items.splice(evt.oldIndex, 1)[0];
                            project.items.splice(evt.newIndex, 0, item);
                            saveData(); renderList();
                        }
                    }
                });
            }
        } catch (e) {
            console.error("Initialization error:", e);
        }
    });

    function toggleDarkMode() {
        isDarkMode = !isDarkMode;
        localStorage.setItem('yazarAparatDark', isDarkMode);
        applyDarkMode();
    }
    function applyDarkMode() {
        if(isDarkMode) document.body.classList.add('dark-mode');
        else document.body.classList.remove('dark-mode');
    }

    function countWords(str) {
        if (!str) return 0;
        const matches = str.trim().match(/\S+/g);
        return matches ? matches.length : 0;
    }
    
    function calculateTotalWords() {
        const project = getActiveProject();
        if(!project) {
            document.getElementById('totalWordCount').innerHTML = `<span>üìù</span> 0 ${t('word_label')}`;
            return;
        }
        let total = 0;
        project.items.forEach(item => {
            total += countWords(item.content || "");
        });
        document.getElementById('totalWordCount').innerHTML = `<span>üìù</span> ${total} ${t('word_label')}`;
    }

    function updateItemCount(index, val) {
        const count = countWords(val);
        const badge = document.getElementById(`word-badge-${index}`);
        if(badge) badge.textContent = `${count} ${t('word_label')}`;
        calculateTotalWords();
    }

    function exportProject() {
        const project = getActiveProject();
        if(!project) return;
        
        const dataStr = JSON.stringify(project);
        const blob = new Blob([dataStr], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const safeName = project.name.replace(/[^a-z0-9]/gi, '_').toLowerCase();
        a.download = `${safeName}_backup_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    function importProject(input) {
        const file = input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedProj = JSON.parse(e.target.result);
                if(importedProj && importedProj.items) {
                    importedProj.id = Date.now();
                    appData.projects.push(importedProj);
                    saveData();
                    alert(t('alert_import'));
                    closeModal('newProjectModal');
                    closeModal('projectsModal');
                    openProject(importedProj.id);
                } else {
                    alert("Invalid project file format.");
                }
            } catch(err) { 
                console.error(err);
                alert("Error reading file."); 
            }
        };
        reader.readAsText(file);
        input.value = ''; 
    }

    function setLanguage(lang) {
        currentLang = lang; localStorage.setItem('yazarAparatLang', lang);
        document.getElementById('btn-en').classList.toggle('active', lang==='en');
        document.getElementById('btn-tr').classList.toggle('active', lang==='tr');
        updateTexts();
    }
    function t(key) { return translations[currentLang][key] || key; }
    
    function updateTexts() {
        document.querySelectorAll('[data-key]').forEach(el => { el.innerHTML = t(el.getAttribute('data-key')); });
        const bulkInput = document.getElementById('bulkTextInput');
        if(bulkInput) bulkInput.placeholder = t('bulk_desc');
        if(activeProjectId) {
            renderList(); 
        }
    }

    function goHome() {
        document.getElementById('view-workspace').classList.remove('active');
        document.getElementById('view-home').classList.add('active');
        document.getElementById('langControl').style.display = 'flex';
        document.getElementById('homeModeControl').style.display = 'flex';
        activeProjectId = null;
    }
    
    function openProject(id) {
        activeProjectId = id;
        document.getElementById('view-home').classList.remove('active');
        document.getElementById('view-workspace').classList.add('active');
        document.getElementById('langControl').style.display = 'none'; 
        document.getElementById('homeModeControl').style.display = 'none';
        renderList();
    }
    
    function getActiveProject() { 
        if(!activeProjectId) return null;
        return appData.projects.find(p => p.id === activeProjectId); 
    }
    
    function updateProjectTitle(newTitle) {
        const p = getActiveProject();
        if(p) { p.name = newTitle; saveData(); }
    }

    function renderList() {
        const project = getActiveProject();
        if(!project) return;
        
        document.getElementById('wsProjTitleInput').value = project.name || '';
        
        const wrapper = document.getElementById('listWrapper');
        wrapper.innerHTML = '';
        
        project.items.forEach((item, index) => {
            const wCount = countWords(item.content || "");
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-header">
                    <div class="drag-handle">‚ò∞</div>
                    <input type="number" class="item-number-input" value="${index + 1}" onchange="reorderItem(${index}, this.value)">
                    <textarea class="item-title-input" rows="1" placeholder="${t('ph_item_title')}" oninput="autoResize(this); updateItem(${index}, 'text', this.value)">${item.text}</textarea>
                    <div class="card-actions">
                        <button class="icon-btn-text" onclick="toggleItemField(${index}, 'showDesc')">üìù</button>
                        <button class="icon-btn-text" onclick="toggleItemField(${index}, 'showContent')">‚úç</button>
                        <button class="icon-btn-text" style="color:var(--danger)" onclick="deleteItem(${index})">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="content-area ${item.showDesc ? 'show' : ''}">
                    <textarea class="smart-input" placeholder="${t('ph_desc')}" oninput="updateItem(${index}, 'desc', this.value)">${item.desc || ''}</textarea>
                </div>
                <div class="content-area ${item.showContent ? 'show' : ''}" style="background:rgba(58, 110, 165, 0.05);">
                    <textarea class="smart-input" style="min-height:100px;" placeholder="${t('ph_text')}" oninput="updateItem(${index}, 'content', this.value); updateItemCount(${index}, this.value)">${item.content || ''}</textarea>
                    <div class="word-count-badge" id="word-badge-${index}">${wCount} ${t('word_label')}</div>
                </div>`;
            wrapper.appendChild(card);
        });
        calculateTotalWords();
        setTimeout(() => document.querySelectorAll('.item-title-input').forEach(el => autoResize(el)), 0);
    }

    function addItem() { 
        const proj = getActiveProject();
        if(proj) {
            proj.items.push({ text: '', desc: '', content: '', showDesc: false, showContent: true }); 
            saveData(); 
            renderList(); 
        }
    }
    
    function deleteItem(idx) { 
        if(confirm('Delete?')) { 
            const proj = getActiveProject();
            if(proj) {
                proj.items.splice(idx, 1); 
                saveData(); 
                renderList(); 
            }
        } 
    }
    
    function updateItem(idx, key, val) { 
        const proj = getActiveProject();
        if(proj && proj.items[idx]) {
            proj.items[idx][key] = val; 
            saveData(); 
        }
    }
    
    function toggleItemField(idx, key) { 
        const proj = getActiveProject();
        if(proj && proj.items[idx]) {
            proj.items[idx][key] = !proj.items[idx][key]; 
            saveData(); 
            renderList(); 
        }
    }
    
    function reorderItem(oldIdx, newSeq) {
        const proj = getActiveProject();
        if(!proj) return;
        let newIdx = parseInt(newSeq) - 1;
        if(isNaN(newIdx) || newIdx < 0) newIdx = 0;
        if(newIdx >= proj.items.length) newIdx = proj.items.length - 1;
        const item = proj.items.splice(oldIdx, 1)[0];
        proj.items.splice(newIdx, 0, item);
        saveData(); renderList();
    }
    
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openProjectsModal() { renderProjectsList(); document.getElementById('projectsModal').style.display = 'flex'; }
    function openNewProjectModal() { document.getElementById('newProjectModal').style.display = 'flex'; document.getElementById('newProjNameInput').value=''; }
    
    function renderProjectsList() {
        const list = document.getElementById('projectsListEl'); list.innerHTML = '';
        if(!appData.projects || appData.projects.length === 0) {
            document.getElementById('noProjectsMsg').style.display = 'block';
        } else {
            document.getElementById('noProjectsMsg').style.display = 'none';
            appData.projects.forEach(p => {
                const li = document.createElement('li'); li.className = 'proj-item';
                li.innerHTML = `<span onclick="closeModal('projectsModal'); openProject(${p.id})">${p.name}</span> <button style="color:var(--danger); background:none; border:none;" onclick="deleteProject(${p.id})">üóëÔ∏è</button>`;
                list.appendChild(li);
            });
        }
    }
    
    function createProjectAction() {
        const name = document.getElementById('newProjNameInput').value.trim();
        if(name) {
            const newP = { id: Date.now(), name: name, items: [] };
            appData.projects.push(newP); saveData();
            closeModal('newProjectModal'); closeModal('projectsModal');
            openProject(newP.id);
        } else { alert("Please enter a name."); }
    }
    
    function handleEnterProject(e) { if(e.key === 'Enter') createProjectAction(); }
    
    function deleteProject(id) { 
        if(confirm('Delete project?')) { 
            appData.projects = appData.projects.filter(p => p.id !== id); 
            saveData(); 
            renderProjectsList(); 
        } 
    }
    
    function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
    function saveData(alertUser) { localStorage.setItem('yazarAparatV5', JSON.stringify(appData)); if(alertUser) alert(t('alert_save')); }
    
    function loadData() { 
        const d = localStorage.getItem('yazarAparatV5'); 
        if(d) {
            appData = JSON.parse(d); 
        } else { 
            const old = localStorage.getItem('yazarAparatV4'); 
            if(old) appData = JSON.parse(old); 
        }
        if(!appData.projects) appData.projects = [];
    }
    
    function changeZoom(val) { document.documentElement.style.setProperty('--scale-factor', val); }

    function openPreview() {
        const proj = getActiveProject();
        if(!proj) return;
        const paper = document.getElementById('previewPaper');
        // Reset clean view class when opening
        paper.classList.remove('clean-view');
        
        let html = `<h1 style="text-align:center">${proj.name}</h1>`;
        proj.items.forEach((item, i) => {
            if(item.text || (item.content && item.content.trim())) {
                html += `<div style="margin-bottom:20px"><h3>${i+1}. ${item.text}</h3><div style="text-align:justify; white-space:pre-wrap;">${item.content || ''}</div></div>`;
            }
        });
        paper.innerHTML = html;
        document.getElementById('previewModal').style.display = 'flex';
    }

    function toggleCleanView() {
        const paper = document.getElementById('previewPaper');
        paper.classList.toggle('clean-view');
    }
    
    function exportWord() {
        const proj = getActiveProject();
        if(!proj) return;
        const html = document.getElementById('previewPaper').innerHTML;
        const pre = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Doc</title></head><body>";
        const post = "</body></html>";
        const blob = new Blob(['\ufeff', pre + html + post], {type: 'application/msword'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); a.download = proj.name + ".doc";
        a.click();
    }
    
    function toggleBulk() { const b = document.getElementById('bulkArea'); b.style.display = b.style.display==='block'?'none':'block'; }
    
    function processBulk() {
        const proj = getActiveProject();
        if(!proj) return;
        const txt = document.getElementById('bulkTextInput').value;
        if(!txt.trim()) return;
        txt.split('\n').forEach(l => { if(l.trim()) proj.items.push({text:l, showContent:true}) });
        saveData(); renderList(); toggleBulk(); document.getElementById('bulkTextInput').value='';
    }
    
    function toggleAll(k) { 
        const proj = getActiveProject();
        if(!proj) return;
        proj.items.forEach(i => i['show'+k.charAt(0).toUpperCase()+k.slice(1)] = !i['show'+k.charAt(0).toUpperCase()+k.slice(1)]); 
        saveData(); renderList(); 
    }
</script>
</body>
</html>