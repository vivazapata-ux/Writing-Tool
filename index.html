<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- iOS i√ßin viewport ayarƒ± -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Writing Tool</title>
    
    <!-- 
        =============================================
        GOOGLE ADSENSE SCRIPT ALANI (AD SPACE - HEAD)
        =============================================
        AdSense onayƒ±ndan sonra size verilen <script> kodunu buraya yapƒ±≈ütƒ±rƒ±n.
        Paste your Google AdSense <script> code here after approval.
    -->

    <!-- SortableJS K√ºt√ºphanesi -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- Fontlar: Inter ve Merriweather -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Renk Paleti */
            --bg-color: #fdfbf7;      
            --text-color: #1e293b;    
            --primary-blue: #3a6ea5;  
            --primary-gold: #cfa15c;  
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --danger: #ef4444;
            --success: #10b981;
            --scale-factor: 1; 
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            height: 100dvh; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            touch-action: manipulation;
            -webkit-font-smoothing: antialiased;
        }

        /* --- REKLAM ALANLARI ƒ∞√áƒ∞N CSS (AD STYLES) --- */
        .ad-banner {
            width: 100%;
            text-align: center;
            background: transparent;
            min-height: 0; 
            overflow: hidden;
            flex-shrink: 0; 
        }
        .ad-banner ins { margin: 0 auto; }

        /* --- Dƒ∞L DEƒûƒ∞≈ûTƒ∞Rƒ∞Cƒ∞ (HOME ONLY) --- */
        .lang-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap; /* Metnin kaymasƒ±nƒ± engeller */
        }
        .lang-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 2px;
            border-radius: 4px;
            opacity: 0.5;
            transition: opacity 0.2s, transform 0.2s;
        }
        .lang-btn:hover { opacity: 1; transform: scale(1.1); }
        .lang-btn.active { opacity: 1; border-bottom: 2px solid var(--primary-blue); }

        /* --- ORTAK BUTONLAR --- */
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: var(--text-color);
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            -webkit-tap-highlight-color: transparent;
        }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .btn:active { transform: translateY(0); }
        
        .btn-primary { background: var(--primary-blue); color: white; border: none; }
        .btn-primary:hover { background: #2c5282; }
        
        .btn-gold { background: var(--primary-gold); color: white; border: none; }
        .btn-gold:hover { background: #b08d55; }

        .btn-danger { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
        .btn-danger:hover { background: #fecaca; }

        /* --- G√ñR√úN√úM Y√ñNETƒ∞Mƒ∞ --- */
        .view-section { display: none; height: 100%; width: 100%; position: relative; }
        .view-section.active { display: flex; flex-direction: column; animation: fadeIn 0.3s ease-in-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ANASAYFA --- */
        #view-home { 
            align-items: center; 
            justify-content: center; 
            background: var(--bg-color);
            overflow-y: auto;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
        }

        .home-container {
            width: 100%;
            max-width: 700px;
            text-align: center;
            padding: 40px;
        }

        /* Logo Alanƒ± */
        .logo-area svg {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            filter: drop-shadow(0 8px 16px rgba(58, 110, 165, 0.15));
        }

        .home-title {
            font-size: 32px;
            font-weight: 800;
            color: #0f172a;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
            text-transform: uppercase;
        }

        .home-subtitle {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 25px;
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
        }
        
        .home-subtitle::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background-color: var(--primary-gold);
            border-radius: 2px;
        }

        .home-description {
            font-family: 'Merriweather', serif;
            font-size: 15px;
            line-height: 1.8;
            color: #475569;
            margin-bottom: 40px;
            text-align: justify;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .home-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .big-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 200px;
            height: 100px;
            border-radius: 16px;
            border: none;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            color: white;
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
            font-weight: 700;
            font-size: 16px;
            gap: 10px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            -webkit-tap-highlight-color: transparent;
        }
        
        .big-btn svg { width: 32px; height: 32px; opacity: 0.9; }
        .big-btn:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        .btn-projects { background: linear-gradient(135deg, #3a6ea5 0%, #2c5282 100%); }
        .btn-new { background: linear-gradient(135deg, #cfa15c 0%, #b08d55 100%); }

        /* --- √áALI≈ûMA MASASI --- */
        .workspace-header {
            background: white; 
            padding: 0 20px; 
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            height: 64px; flex-shrink: 0; z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02);
        }
        .header-left, .header-center, .header-right { display: flex; align-items: center; gap: 10px; }
        .project-title-display { font-weight: 700; font-size: 18px; color: var(--text-color); max-width: 250px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;}

        .workspace-body { flex-grow: 1; display: flex; overflow: hidden; position: relative; background-image: radial-gradient(#e2e8f0 1px, transparent 1px); background-size: 20px 20px; }
        .list-container { 
            flex-grow: 1; overflow-y: auto; padding: 30px; 
            display: flex; flex-direction: column; align-items: center;
            -webkit-overflow-scrolling: touch; 
        }
        
        .list-wrapper {
            width: 100%; max-width: 800px; padding-bottom: 150px;
            transform-origin: top center; transform: scale(var(--scale-factor)); margin: 0 auto;
        }

        /* ZOOM */
        .zoom-controls {
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
            height: 200px; background: white; padding: 15px 10px; border-radius: 50px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20;
        }
        .zoom-slider { writing-mode: bt-lr; -webkit-appearance: slider-vertical; width: 8px; height: 140px; accent-color: var(--primary-blue); }

        /* KART TASARIMI */
        .card { 
            background: var(--card-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 12px; 
            margin-bottom: 12px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: box-shadow 0.2s;
        }
        .card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        .card-header { display: flex; align-items: center; padding: 12px 15px; gap: 12px; border-bottom: 1px solid transparent; }
        
        .drag-handle { 
            color: #cbd5e1; cursor: grab; font-size: 20px; display: flex; align-items: center;
            touch-action: none; 
            padding: 5px; 
        }
        .drag-handle:active { cursor: grabbing; }
        
        .item-number-input {
            width: 32px; height: 32px; text-align: center; border: 1px solid #e2e8f0;
            background: #f8fafc; border-radius: 8px; font-size: 14px; font-weight: bold; color: var(--primary-blue);
            outline: none; transition: 0.2s;
        }
        .item-number-input:focus { background: white; border-color: var(--primary-blue); }

        .item-title-input {
            flex-grow: 1; border: none; background: transparent; font-size: 16px; font-weight: 600;
            color: #334155; outline: none; resize: none; overflow: hidden; min-height: 24px; line-height: 1.5; padding: 4px 0; font-family: 'Inter', sans-serif;
        }
        .item-title-input::placeholder { color: #cbd5e1; font-weight: 400; }
        
        .card-actions { display: flex; gap: 5px; }
        .icon-btn { 
            background: transparent; border: 1px solid transparent; cursor: pointer; 
            padding: 6px; border-radius: 6px; font-size: 16px; color: #94a3b8; 
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .icon-btn:hover { background: #f1f5f9; color: #333; transform: scale(1.1); }
        .icon-btn.active { background: #eff6ff; color: var(--primary-blue); border-color: #bfdbfe; }
        .icon-btn.active-green { background: #ecfdf5; color: var(--success); border-color: #a7f3d0; }

        .content-area { display: none; padding: 15px; border-top: 1px dashed #e2e8f0; animation: slideDown 0.2s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .content-area.show { display: block; }
        
        .area-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: #64748b; font-weight: 700; display: block; margin-bottom: 8px; }
        
        textarea.smart-input { 
            width: 100%; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; 
            font-family: 'Merriweather', serif; line-height: 1.6; resize: vertical; 
            box-sizing: border-box; outline: none; font-size: 14px; background: #fcfcfc; color: #334155;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        textarea.smart-input:focus { background: white; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(58, 110, 165, 0.1); }

        /* BULK AREA */
        .bulk-area { 
            display: none; width: 100%; max-width: 800px; margin-bottom: 20px; 
            background: white; padding: 20px; border: 1px solid var(--border-color); 
            border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .bulk-area textarea { width: 100%; height: 150px; margin-bottom: 15px; border: 1px solid var(--border-color); padding: 10px; border-radius: 8px; font-family: 'Inter', sans-serif; }

        /* MODAL (Genel) */
        .modal-overlay { 
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); z-index: 100; 
            justify-content: center; align-items: center; 
            animation: fadeIn 0.2s;
        }
        .modal-content { 
            background: #fff; width: 90%; max-width: 500px; border-radius: 16px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); overflow: hidden; display: flex; flex-direction: column; 
            max-height: 85vh;
        }
        .modal-header { 
            padding: 20px; background: #f8fafc; border-bottom: 1px solid var(--border-color); 
            display: flex; justify-content: space-between; align-items: center; 
        }
        .modal-header h3 { margin: 0; color: #0f172a; }
        .modal-body { 
            padding: 20px; overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
        }
        
        /* Liste (Projeler) */
        .proj-list { list-style: none; padding: 0; margin: 0; }
        .proj-item {
            display: flex; justify-content: space-between; align-items: center; padding: 15px;
            border: 1px solid var(--border-color); border-radius: 10px; margin-bottom: 10px;
            background: #fff; cursor: pointer; transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .proj-item:hover { border-color: var(--primary-blue); transform: translateX(5px); }
        .proj-item-name { font-weight: 600; color: #334155; }
        .proj-actions button { background: none; border: none; cursor: pointer; opacity: 0.5; transition: opacity 0.2s; }
        .proj-actions button:hover { opacity: 1; }

        /* Geni≈ü Modal (√ñnizleme ƒ∞√ßin) */
        .modal-content.large { 
            max-width: 800px; /* Geni≈ülik kƒ±sƒ±tlamasƒ± yok, A4 gibi olacak */
            width: auto; 
            height: 90vh;
            background: transparent; 
            box-shadow: none;
        }

        /* Kelime ƒ∞≈ülemci Kaƒüƒ±t G√∂r√ºn√ºm√º */
        .preview-paper {
            background: white;
            width: 21cm; /* A4 Geni≈üliƒüi */
            min-height: 29.7cm; /* A4 Y√ºksekliƒüi */
            padding: 2.54cm; /* Standart kenar bo≈üluƒüu */
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.15);
            overflow-y: visible; /* ƒ∞√ßerik ta≈üarsa uzasƒ±n */
            font-family: 'Times New Roman', Times, serif; 
            line-height: 1.6; 
            color: #000; 
            font-size: 12pt;
            outline: none; /* Focus outline'ƒ± kaldƒ±r */
            cursor: text;
        }

        .preview-body { 
            padding: 20px; flex-grow: 1; overflow-y: auto; 
            display: flex; justify-content: center; /* Kaƒüƒ±dƒ± ortala */
            background: rgba(0,0,0,0.5); /* Modal arkasƒ± koyu */
            -webkit-overflow-scrolling: touch;
        }

        .preview-item { margin-bottom: 20px; }
        .preview-number { font-weight: bold; margin-right: 5px; }

        /* DETAY Gƒ∞ZLEME CSS */
        .hide-details h3 { display: none !important; } /* Ba≈ülƒ±klarƒ± gizle */
        .hide-details .preview-item { margin-bottom: 15px; } /* Bo≈üluklarƒ± ayarla */
        
        .ghost { opacity: 0.4; background: #cbd5e1; border: 2px dashed #94a3b8; }
        
        /* Responsive */
        @media (max-width: 600px) {
            .home-buttons { flex-direction: column; align-items: center; }
            .big-btn { width: 100%; max-width: 300px; height: 80px; flex-direction: row; }
            .workspace-header { height: auto; flex-wrap: wrap; padding: 10px; gap: 10px; justify-content: center; }
            .header-center { order: 3; width: 100%; justify-content: center; border-top: 1px solid #eee; padding-top: 10px; }
            .preview-paper { width: 95%; padding: 20px; }
        }
    </style>
</head>
<body>

    <!-- ANASAYFA -->
    <div id="view-home" class="view-section active">
        
        <!-- Dƒ∞L DEƒûƒ∞≈ûTƒ∞Rƒ∞Cƒ∞ - SADECE ANASAYFADA G√ñR√úN√úR -->
        <div class="lang-switcher">
            <span data-key="language_label">Language:</span>
            <button class="lang-btn" onclick="setLanguage('en')" id="btn-en">üá¨üáß</button>
            <div style="width:1px; height:15px; background:#ddd;"></div>
            <button class="lang-btn" onclick="setLanguage('tr')" id="btn-tr">üáπüá∑</button>
        </div>

        <div class="home-container">
            <!-- Logo SVG: Kalem ve √áip Tasarƒ±mƒ± -->
            <div class="logo-area">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Devre Yollarƒ± (Chip Arkaplan) -->
                    <path d="M20 80 L30 80 L35 75" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round"/>
                    <path d="M80 80 L70 80 L65 75" stroke="#e2e8f0" stroke-width="2" stroke-linecap="round"/>
                    <rect x="35" y="65" width="30" height="25" rx="4" stroke="#cfa15c" stroke-width="2" fill="white"/>
                    <circle cx="42" cy="72" r="2" fill="#cfa15c"/>
                    <circle cx="58" cy="72" r="2" fill="#cfa15c"/>
                    <circle cx="42" cy="82" r="2" fill="#cfa15c"/>
                    <circle cx="58" cy="82" r="2" fill="#cfa15c"/>
                    
                    <!-- Dolma Kalem (Quill) -->
                    <path d="M70 20 C70 20 50 25 40 45 C35 55 35 65 48 65 C60 65 75 50 80 30 C82 20 70 20 70 20 Z" fill="#3a6ea5" stroke="#2c5282" stroke-width="2"/>
                    <path d="M48 65 L35 85" stroke="#2c5282" stroke-width="3" stroke-linecap="round"/> <!-- Kalem Ucu G√∂vdesi -->
                    <path d="M35 85 L32 92 L38 92 Z" fill="#2c5282"/> <!-- Metal U√ß -->
                    <path d="M40 45 C45 45 65 30 70 20" stroke="white" stroke-width="1.5" stroke-opacity="0.5"/> <!-- I≈üƒ±k Yansƒ±masƒ± -->
                </svg>
            </div>

            <div class="home-title" data-key="app_title">WRITING TOOL</div>
            <div class="home-subtitle" data-key="app_subtitle">WHAT IS THE WRITING TOOL?</div>
            
            <div class="home-description" data-key="app_description">
                The Writing Tool is a simple instrument for creating outlines for your complex texts and easily organizing this flow. If desired, it is also possible to write the entire text within the "Writing Tool".<br><br>
                When you enter the flow step by step, all items will be numbered by the system. At this point, you can enter descriptions for items and change their positions as you wish to finalize the fiction of the text. (Items can be moved by dragging with the cursor or by changing the sequence number.) To write the text from within the "Writing Tool", you can add text specific to the item, view your text from the "Preview" section when the entire flow is completed, and then print/export it.
            </div>

            <div class="home-buttons">
                <button class="big-btn btn-projects" onclick="openProjectsModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                    <span data-key="btn_my_projects">MY PROJECTS</span>
                </button>
                <button class="big-btn btn-new" onclick="openNewProjectModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    <span data-key="btn_new_project">NEW PROJECT</span>
                </button>
            </div>

            <!-- REKLAM ALANI / AD SPACE - ANASAYFA (HOME) -->
            <div class="ad-banner">
                <!-- Reklam kodu -->
            </div>

        </div>
    </div>

    <!-- √áALI≈ûMA MASASI -->
    <div id="view-workspace" class="view-section">
        <div class="workspace-header">
            <div class="header-left">
                <button class="btn" onclick="goHome()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                    <span data-key="nav_home">Home</span>
                </button>
                <div class="project-title-display" id="wsProjTitle">Project Name</div>
                <button class="btn" onclick="saveData(true)" title="Save">üíæ <span data-key="nav_save">Save</span></button>
            </div>
            <div class="header-center">
                <button class="btn" onclick="toggleAll('desc')">üìù <span data-key="nav_notes">Notes</span></button>
                <button class="btn" onclick="toggleAll('content')">‚úç <span data-key="nav_drafts">Drafts</span></button>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="toggleBulk()">+ <span data-key="nav_bulk">Bulk Add</span></button>
                <button class="btn btn-gold" onclick="addItem()">+ <span data-key="nav_single">Add Item</span></button>
                <button class="btn btn-success" onclick="openPreview()" style="background-color: #10b981;">üëÅ <span data-key="nav_preview">Preview</span></button>
            </div>
        </div>

        <div class="workspace-body">
            <div class="list-container">
                <div class="bulk-area" id="bulkArea">
                    <h4 style="margin-top:0; color: var(--primary-blue);" data-key="bulk_title">Bulk Add Items</h4>
                    <div style="font-size:13px; margin-bottom:10px; color:#64748b;" data-key="bulk_desc">Paste your items line by line. Numbers will be added automatically.</div>
                    <textarea id="bulkTextInput" placeholder="Introduction&#10;Character Analysis&#10;Development..."></textarea>
                    <div style="text-align:right; display:flex; justify-content:flex-end; gap:10px;">
                        <button class="btn" onclick="toggleBulk()" data-key="btn_cancel">Cancel</button>
                        <button class="btn btn-primary" onclick="processBulk()" data-key="btn_add">Add Items</button>
                    </div>
                </div>

                <div class="list-wrapper" id="listWrapper"></div>
            </div>

            <div class="zoom-controls">
                <div style="font-size:14px; color:#94a3b8; margin:8px 0;">+</div>
                <input type="range" min="0.5" max="1.1" step="0.05" value="1" class="zoom-slider" oninput="changeZoom(this.value)">
                <div style="font-size:14px; color:#94a3b8; margin:8px 0;">-</div>
            </div>
        </div>

        <!-- REKLAM ALANI / AD SPACE - √áALI≈ûMA MASASI (WORKSPACE BOTTOM) -->
        <div class="ad-banner">
            <!-- Alt ≈üerit reklam kodunuzu buraya yapƒ±≈ütƒ±rƒ±n. -->
        </div>
    </div>

    <!-- PROJELER MODALI -->
    <div class="modal-overlay" id="projectsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-key="modal_saved_projects">Saved Projects</h3>
                <button class="btn" onclick="closeModal('projectsModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <ul class="proj-list" id="projectsListEl"></ul>
                <div id="noProjectsMsg" style="text-align:center; color:#94a3b8; padding:20px; display:none;" data-key="msg_no_projects">
                    You don't have any projects yet.
                </div>
            </div>
            <div style="padding:15px; background:#f8fafc; text-align:right;">
                <button class="btn btn-gold" onclick="closeModal('projectsModal'); openNewProjectModal()">+ <span data-key="btn_create_new">Create New Project</span></button>
            </div>
        </div>
    </div>

    <!-- YENƒ∞ PROJE MODALI -->
    <div class="modal-overlay" id="newProjectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-key="modal_new_project">Create New Project</h3>
                <button class="btn" onclick="closeModal('newProjectModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <label style="display:block; margin-bottom:8px; font-weight:600; color:#475569;" data-key="label_proj_name">Project Name</label>
                <input type="text" id="newProjNameInput" placeholder="Ex: New Novel Draft" 
                       style="width:100%; padding:12px; border:1px solid #cbd5e1; border-radius:8px; font-size:16px; outline:none; box-sizing:border-box;"
                       onkeypress="handleEnterProject(event)">
            </div>
            <div style="padding:20px; text-align:right; display:flex; justify-content:flex-end; gap:10px;">
                <button class="btn" onclick="closeModal('newProjectModal')" data-key="btn_cancel">Cancel</button>
                <button class="btn btn-primary" onclick="createProjectAction()" data-key="btn_create_start">Create & Start</button>
            </div>
        </div>
    </div>

    <!-- √ñNƒ∞ZLEME MODALI -->
    <div class="modal-overlay" id="previewModal">
        <div class="modal-content large">
            <div class="modal-header" style="background: #fff; border-radius: 8px 8px 0 0; padding: 15px 25px;">
                <div style="display:flex; flex-direction:column;">
                    <h3 style="margin:0" data-key="preview_title">Free Edit & Preview</h3>
                    <span style="font-size:12px; color:#ef4444;" data-key="preview_warning">Note: Changes here are free-form and will not reflect back to the cards. For export only.</span>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn" onclick="exportWord()">üìÑ <span data-key="btn_word">Download Word</span></button>
                    <button class="btn" id="toggleDetailsBtn" onclick="togglePreviewDetails()" data-key="btn_show_text_only">Show Text Only</button>
                    <button class="btn btn-primary" onclick="closeModal('previewModal');" data-key="btn_close">Close</button>
                </div>
            </div>
            <div class="preview-body" id="previewBodyContainer">
                <!-- A4 Kaƒüƒ±dƒ± -->
                <div id="previewPaper" class="preview-paper" contenteditable="true"></div>
            </div>
        </div>
    </div>

<script>
    // --- √áEVƒ∞Rƒ∞ S√ñZL√úƒû√ú ---
    const translations = {
        en: {
            language_label: "Language:",
            app_title: "WRITING TOOL",
            app_subtitle: "WHAT IS THE WRITING TOOL?",
            app_description: `The Writing Tool is a simple instrument for creating outlines for your complex texts and easily organizing this flow. If desired, it is also possible to write the entire text within the "Writing Tool".<br><br>When you enter the flow step by step, all items will be numbered by the system. At this point, you can enter descriptions for items and change their positions as you wish to finalize the fiction of the text. (Items can be moved by dragging with the cursor or by changing the sequence number.) To write the text from within the "Writing Tool", you can add text specific to the item, view your text from the "Preview" section when the entire flow is completed, and then print/export it.`,
            btn_my_projects: "MY PROJECTS",
            btn_new_project: "NEW PROJECT",
            nav_home: "Home",
            nav_save: "Save",
            nav_notes: "Notes",
            nav_drafts: "Drafts",
            nav_bulk: "Bulk Add",
            nav_single: "Add Item",
            nav_preview: "Preview",
            bulk_title: "Bulk Add Items",
            bulk_desc: "Paste your items line by line. Numbers will be added automatically.",
            bulk_ph: "Introduction\nCharacter Analysis\nDevelopment...",
            btn_cancel: "Cancel",
            btn_add: "Add Items",
            modal_saved_projects: "Saved Projects",
            msg_no_projects: "You don't have any projects yet.",
            btn_create_new: "Create New Project",
            modal_new_project: "Create New Project",
            label_proj_name: "Project Name",
            ph_proj_name: "Ex: New Novel Draft",
            btn_create_start: "Create & Start",
            preview_title: "Free Edit & Preview",
            preview_warning: "Note: Changes here are free-form and will not reflect back to the cards. For export only.",
            btn_word: "Download Word",
            btn_show_text_only: "Show Text Only",
            btn_show_all: "Show All Details",
            btn_close: "Close",
            ph_item_title: "Item Title...",
            label_desc: "üìå Section Description / Notes",
            ph_desc: "What will happen in this section?",
            label_text: "üìÑ Draft Text",
            ph_text: "Write your text here...",
            msg_list_empty: "Your list is empty.<br>Start by adding 'Add Item' or 'Bulk Add' above.",
            msg_no_content: "No content yet.",
            alert_proj_name: "Please enter a project name.",
            alert_delete_proj: "Are you sure you want to delete the project and all its content?",
            prompt_rename: "New project name:",
            alert_delete_item: "Do you want to delete this item?",
            alert_save_success: "Project saved successfully!"
        },
        tr: {
            language_label: "Dil:",
            app_title: "YAZARLIK APARATI",
            app_subtitle: "YAZARLIK APARATI NEDƒ∞R?",
            app_description: `Yazarlƒ±k Aparatƒ±, karma≈üƒ±k metinleriniz i√ßin akƒ±≈ü (outline) √ßƒ±karmaya ve bu akƒ±≈üƒ± kolayca d√ºzenlemenize yarayan basit bir ara√ßtƒ±r. Arzu edersenler i√ßin metnin tamamƒ±nƒ± ‚ÄúYazarlƒ±k Aparatƒ±" i√ßinde yazmak da m√ºmk√ºnd√ºr.<br><br>Akƒ±≈üƒ± sisteme adƒ±m adƒ±m girdiƒüinizde t√ºm maddeler sistem tarafƒ±ndan numaralandƒ±rƒ±lacaktƒ±r. Bu noktada maddelere a√ßƒ±klamalar girebilir ve onlarƒ±n yerlerini istediƒüiniz gibi deƒüi≈ütirerek metnin kurgusuna son halini verebilirsiniz. (Maddelerin yeri imle√ßle s√ºr√ºklenerek ya da sƒ±ra numarasƒ±na m√ºdahale edilerek deƒüi≈ütirilebilir.) Metni ‚ÄúYazarlƒ±k Aparatƒ±‚Äù i√ßinden yazmak i√ßin ise madde √∂zelinde metin ekleyebilir, t√ºm akƒ±≈ü tamamladƒ±ƒüƒ±nda ‚Äú√ñnizle" kƒ±smƒ±ndan metninizi g√∂r√ºnt√ºleyebilir ve daha sonrasƒ±nda √ßƒ±ktƒ± alabilirsiniz.`,
            btn_my_projects: "PROJELERƒ∞M",
            btn_new_project: "YENƒ∞ PROJE",
            nav_home: "Anasayfa",
            nav_save: "Kaydet",
            nav_notes: "A√ßƒ±klamalar",
            nav_drafts: "Metinler",
            nav_bulk: "Toplu Ekle",
            nav_single: "Tek Madde",
            nav_preview: "√ñnizle",
            bulk_title: "Toplu Madde Ekle",
            bulk_desc: "Maddelerinizi alt alta yapƒ±≈ütƒ±rƒ±n. Numaralar otomatik eklenecektir.",
            bulk_ph: "Giri≈ü B√∂l√ºm√º\nKarakter Tanƒ±tƒ±mƒ±\nGeli≈üme...",
            btn_cancel: "ƒ∞ptal",
            btn_add: "Ekle",
            modal_saved_projects: "Kayƒ±tlƒ± Projelerim",
            msg_no_projects: "Hen√ºz hi√ß projen yok.",
            btn_create_new: "Yeni Proje Olu≈ütur",
            modal_new_project: "Yeni Proje Olu≈ütur",
            label_proj_name: "Proje ƒ∞smi",
            ph_proj_name: "√ñrn: Yeni Roman Taslaƒüƒ±",
            btn_create_start: "Olu≈ütur ve Ba≈üla",
            preview_title: "Serbest D√ºzenleme & √ñnizleme",
            preview_warning: "Dikkat: Buradaki deƒüi≈üiklikler serbest formattƒ±r ve kartlara geri yansƒ±maz. Sadece √ßƒ±ktƒ± i√ßindir.",
            btn_word: "Word ƒ∞ndir",
            btn_show_text_only: "Sadece Metni G√∂ster",
            btn_show_all: "T√ºm Detaylarƒ± G√∂ster",
            btn_close: "Kapat",
            ph_item_title: "Madde Ba≈ülƒ±ƒüƒ±...",
            label_desc: "üìå B√∂l√ºm A√ßƒ±klamasƒ± / Notlar",
            ph_desc: "Bu b√∂l√ºmde neler olacak?",
            label_text: "üìÑ Taslak Metin",
            ph_text: "Metninizi buraya yazƒ±n...",
            msg_list_empty: "Listeniz bo≈ü.<br>Yukarƒ±dan 'Tek Madde' veya 'Toplu Madde' ekleyerek ba≈ülayƒ±n.",
            msg_no_content: "Hen√ºz i√ßerik yok.",
            alert_proj_name: "L√ºtfen proje ismi giriniz.",
            alert_delete_proj: "Projeyi ve t√ºm i√ßeriƒüini silmek istediƒüinize emin misiniz?",
            prompt_rename: "Yeni proje adƒ±:",
            alert_delete_item: "Maddeyi silmek istiyor musun?",
            alert_save_success: "Proje ba≈üarƒ±yla kaydedildi!"
        }
    };

    let currentLang = localStorage.getItem('yazarAparatLang') || 'en'; // Varsayƒ±lan ƒ∞ngilizce

    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('yazarAparatLang', lang);
        
        // Buton stillerini g√ºncelle
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`btn-${lang}`).classList.add('active');

        updateTexts();
    }

    // Yardƒ±mcƒ± √ßeviri fonksiyonu
    function t(key) {
        return translations[currentLang][key] || key;
    }

    function updateTexts() {
        // data-key olan elementleri g√ºncelle
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if(translations[currentLang][key]) {
                // Eƒüer input/textarea ise placeholder'ƒ± g√ºncelle
                if(el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    // Placeholder g√ºncelleme mantƒ±ƒüƒ± √∂zel alanlar i√ßin manuel yapƒ±labilir
                } else {
                    el.innerHTML = translations[currentLang][key];
                }
            }
        });

        // Placeholderlarƒ± g√ºncelle
        const bulkInput = document.getElementById('bulkTextInput');
        if(bulkInput) bulkInput.placeholder = t('bulk_ph');
        
        const projInput = document.getElementById('newProjNameInput');
        if(projInput) projInput.placeholder = t('ph_proj_name');

        // Eƒüer liste a√ßƒ±ksa listeyi yeniden render et (placeholderlar deƒüi≈üsin diye)
        if(document.getElementById('view-workspace').classList.contains('active')) {
            renderList();
        }
        
        // Detay butonu metnini g√ºncelle
        updateDetailsButton();
        
        // Ba≈ülƒ±k g√ºncelleme
        document.title = t('app_title');
    }

    let appData = { projects: [] };
    let activeProjectId = null;
    let isDetailsHidden = false;

    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        setLanguage(currentLang); // Dili y√ºkle
        
        new Sortable(document.getElementById('listWrapper'), {
            handle: '.drag-handle',
            animation: 150,
            ghostClass: 'ghost',
            onEnd: function (evt) {
                const project = getActiveProject();
                const item = project.items.splice(evt.oldIndex, 1)[0];
                project.items.splice(evt.newIndex, 0, item);
                saveData();
                renderList();
            }
        });
    });

    // --- NAVIGATION & MODALS ---
    function goHome() {
        document.getElementById('view-workspace').classList.remove('active');
        document.getElementById('view-home').classList.add('active');
        activeProjectId = null;
    }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openProjectsModal() { renderProjectsList(); document.getElementById('projectsModal').style.display = 'flex'; }
    function openNewProjectModal() {
        document.getElementById('newProjNameInput').value = '';
        document.getElementById('newProjectModal').style.display = 'flex';
        setTimeout(() => document.getElementById('newProjNameInput').focus(), 100);
    }
    function handleEnterProject(e) { if(e.key === 'Enter') createProjectAction(); }

    function renderProjectsList() {
        const list = document.getElementById('projectsListEl');
        list.innerHTML = '';
        if(appData.projects.length === 0) { document.getElementById('noProjectsMsg').style.display = 'block'; return; }
        document.getElementById('noProjectsMsg').style.display = 'none';
        
        appData.projects.forEach(p => {
            const li = document.createElement('li');
            li.className = 'proj-item';
            li.innerHTML = `
                <div class="proj-item-name" onclick="openProjectAndCloseModal(${p.id})">${p.name} <span style="font-weight:400; font-size:12px; color:#94a3b8;">(${p.items.length})</span></div>
                <div class="proj-actions">
                    <button onclick="renameProject(${p.id})" title="Rename">‚úèÔ∏è</button>
                    <button onclick="deleteProject(${p.id})" title="Delete" style="color:#ef4444;">üóëÔ∏è</button>
                </div>`;
            list.appendChild(li);
        });
    }

    function createProjectAction() {
        const name = document.getElementById('newProjNameInput').value.trim();
        if(!name) return alert(t('alert_proj_name'));
        const newProj = { id: Date.now(), name: name, items: [] };
        appData.projects.push(newProj);
        saveData();
        closeModal('newProjectModal');
        closeModal('projectsModal'); 
        openProject(newProj.id);
    }

    function openProjectAndCloseModal(id) { closeModal('projectsModal'); openProject(id); }
    function openProject(id) {
        activeProjectId = id;
        document.getElementById('view-home').classList.remove('active');
        document.getElementById('view-workspace').classList.add('active');
        renderList();
    }
    function deleteProject(id) {
        if(confirm(t('alert_delete_proj'))) {
            appData.projects = appData.projects.filter(p => p.id !== id);
            saveData();
            renderProjectsList(); 
        }
    }
    function renameProject(id) {
        const p = appData.projects.find(x => x.id === id);
        const newName = prompt(t('prompt_rename'), p.name);
        if(newName && newName.trim()) { p.name = newName.trim(); saveData(); renderProjectsList(); }
    }
    function getActiveProject() { return appData.projects.find(p => p.id === activeProjectId); }

    // --- WORKSPACE LOGIC ---
    function renderList() {
        const project = getActiveProject();
        if(!project) return;
        document.getElementById('wsProjTitle').textContent = project.name;
        const wrapper = document.getElementById('listWrapper');
        wrapper.innerHTML = '';
        if(project.items.length === 0) {
            wrapper.innerHTML = `<div style="text-align:center; color:#94a3b8; margin-top:50px; font-style:italic;">${t('msg_list_empty')}</div>`;
            return;
        }
        project.items.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-header">
                    <div class="drag-handle" title="Drag">‚ò∞</div>
                    <input type="number" class="item-number-input" value="${index + 1}" onchange="reorderItem(${index}, this.value)" onkeypress="handleOrderEnter(event, ${index}, this.value)">
                    <textarea class="item-title-input" rows="1" placeholder="${t('ph_item_title')}" oninput="autoResize(this); updateItem(${index}, 'text', this.value)">${item.text}</textarea>
                    <div class="card-actions">
                        <button class="icon-btn ${item.showDesc ? 'active' : ''}" onclick="toggleItemField(${index}, 'showDesc')" title="Notes">üìù</button>
                        <button class="icon-btn ${item.showContent ? 'active-green' : ''}" onclick="toggleItemField(${index}, 'showContent')" title="Draft">‚úçÔ∏è</button>
                        <button class="icon-btn" style="color:var(--danger)" onclick="deleteItem(${index})" title="Delete">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="content-area ${item.showDesc ? 'show' : ''}">
                    <span class="area-label">${t('label_desc')}</span>
                    <textarea class="smart-input" placeholder="${t('ph_desc')}" oninput="updateItem(${index}, 'desc', this.value)">${item.desc || ''}</textarea>
                </div>
                <div class="content-area ${item.showContent ? 'show' : ''}" style="background:#f0fdf4;">
                    <span class="area-label" style="color:#15803d">${t('label_text')}</span>
                    <textarea class="smart-input" style="min-height:100px; border-color:#86efac;" placeholder="${t('ph_text')}" oninput="updateItem(${index}, 'content', this.value)">${item.content || ''}</textarea>
                </div>`;
            wrapper.appendChild(card);
        });
        setTimeout(() => { document.querySelectorAll('.item-title-input').forEach(el => autoResize(el)); }, 0);
    }

    function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
    function addItem() { getActiveProject().items.push({ text: '', desc: '', content: '', showDesc: false, showContent: true }); saveData(); renderList(); setTimeout(() => { document.querySelector('.list-container').scrollTop = 99999; }, 100); }
    function deleteItem(index) { if(confirm(t('alert_delete_item'))) { getActiveProject().items.splice(index, 1); saveData(); renderList(); } }
    function updateItem(index, key, value) { getActiveProject().items[index][key] = value; saveData(); }
    function toggleItemField(index, key) { const item = getActiveProject().items[index]; item[key] = !item[key]; saveData(); renderList(); }

    function handleOrderEnter(e, oldIndex, newVal) { if(e.key === 'Enter') { reorderItem(oldIndex, newVal); e.target.blur(); } }
    function reorderItem(oldIndex, newValStr) {
        const project = getActiveProject();
        let newIndex = parseInt(newValStr) - 1;
        if (isNaN(newIndex)) return renderList();
        if (newIndex < 0) newIndex = 0;
        if (newIndex >= project.items.length) newIndex = project.items.length - 1;
        if (newIndex === oldIndex) return;
        const item = project.items.splice(oldIndex, 1)[0];
        project.items.splice(newIndex, 0, item);
        saveData(); renderList();
    }

    function toggleBulk() { const area = document.getElementById('bulkArea'); area.style.display = (area.style.display === 'block') ? 'none' : 'block'; }
    function processBulk() {
        const txt = document.getElementById('bulkTextInput').value;
        if(!txt.trim()) return;
        txt.split('\n').forEach(line => {
            if(line.trim()) {
                let clean = line.trim().replace(/^\d+[\.\-\)]\s*/, '');
                getActiveProject().items.push({ text: clean, desc: '', content: '', showDesc: false, showContent: false });
            }
        });
        document.getElementById('bulkTextInput').value = '';
        toggleBulk(); saveData(); renderList();
    }
    function toggleAll(type) {
        const project = getActiveProject();
        const key = (type === 'desc') ? 'showDesc' : 'showContent';
        const allOpen = project.items.every(item => item[key]);
        project.items.forEach(item => item[key] = !allOpen);
        saveData(); renderList();
    }
    function changeZoom(val) { document.documentElement.style.setProperty('--scale-factor', val); }

    // --- PREVIEW & EXPORT & FREE EDIT ---
    function openPreview() {
        const project = getActiveProject();
        const paper = document.getElementById('previewPaper');
        let html = `<h1 style="text-align:center; margin-bottom:30px;">${project.name}</h1>`;
        
        project.items.forEach((item, index) => {
            if(item.text || (item.content && item.content.trim())) {
                html += `<div class="preview-item">
                    ${item.text ? `<h3 style="margin-bottom:10px;"><span class="preview-number">${index+1}.</span> ${item.text}</h3>` : ''}
                    ${item.content ? `<div style="text-align:justify; white-space: pre-wrap;">${item.content}</div>` : ''}
                    ${(!item.text && !item.content) ? '' : '<br>'}
                </div>`;
            }
        });
        if(project.items.length === 0) html = `<p style="text-align:center; color:#999;">${t('msg_no_content')}</p>`;
        
        paper.innerHTML = html;
        
        isDetailsHidden = false; // Reset
        updateDetailsButton();
        document.getElementById('previewModal').style.display = 'flex';
    }

    function togglePreviewDetails() {
        const paper = document.getElementById('previewPaper');
        isDetailsHidden = !isDetailsHidden;
        if(isDetailsHidden) {
            paper.classList.add('hide-details');
        } else {
            paper.classList.remove('hide-details');
        }
        updateDetailsButton();
    }

    function updateDetailsButton() {
        const btn = document.getElementById('toggleDetailsBtn');
        btn.textContent = isDetailsHidden ? t('btn_show_all') : t('btn_show_text_only');
    }

    function exportWord() {
        const project = getActiveProject();
        const content = document.getElementById('previewPaper').innerHTML;
        
        const preHtml = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>";
        const postHtml = "</body></html>";
        const html = preHtml + content + postHtml;

        const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
        const url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);
        const downloadLink = document.createElement("a");
        document.body.appendChild(downloadLink);
        
        if(navigator.msSaveOrOpenBlob ){
            navigator.msSaveOrOpenBlob(blob, project.name + ".doc");
        } else {
            downloadLink.href = url;
            downloadLink.download = project.name + ".doc";
            downloadLink.click();
        }
        document.body.removeChild(downloadLink);
    }

    function saveData(showAlert = false) { 
        localStorage.setItem('yazarAparatV5', JSON.stringify(appData)); 
        if(showAlert) alert(t('alert_save_success')); 
    }
    function loadData() {
        const raw = localStorage.getItem('yazarAparatV5');
        if(raw) { appData = JSON.parse(raw); } 
        else { const oldRaw = localStorage.getItem('yazarAparatV4'); if(oldRaw) appData = JSON.parse(oldRaw); }
    }
</script>
</body>
</html>